name: Cargo Publish
on:
  release:
    types: [published]

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: dtolnay/rust-toolchain@stable
      - name: Publish to Crates.io
        env:
          CARGO_REGISTRY_TOKEN: ${{ secrets.CARGO_REGISTRY_TOKEN }}
        run: |
          TAG_NAME=${{ github.ref_name }}
          # Check for format like crate-name-v1.2.3
          if [[ "$TAG_NAME" =~ ^(.*)-v[0-9]+\.[0-9]+\.[0-9]+$ ]]; then
            CRATE_NAME="${BASH_REMATCH[1]}"
            echo "Publishing crate: $CRATE_NAME"
            cargo publish -p "$CRATE_NAME"
          else
            echo "Skipping publish: Tag '$TAG_NAME' does not match crate version format."
          fi
